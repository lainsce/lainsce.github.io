<!DOCTYPE html>
<html lang='en'>
<head>
  <script>const module = { exports: null }</script>
  <script>const DATABASE = {}</script>
  <script>const BINDINGS = {}</script>
  <script>const PROJECTS = {}</script>

  <script type='text/javascript' src='scripts/lib/helpers.js'></script>
  <script type='text/javascript' src='scripts/lib/neralie.js'></script>
  <script type='text/javascript' src='scripts/lib/arvelie.js'></script>
  <script type='text/javascript' src='scripts/lib/runic.js'></script>
  <script type='text/javascript' src='scripts/lib/indental.js'></script>
  <script type='text/javascript' src='scripts/lib/tablatal.js'></script>

  <script type='text/javascript' src='scripts/database/lexicon.ndtl'></script>
  <script type='text/javascript' src='scripts/database/horaire.tbtl'></script>

  <script type='text/javascript' src='scripts/types/entry.js'></script>
  <script type='text/javascript' src='scripts/types/term.js'></script>
  <script type='text/javascript' src='scripts/types/list.js'></script>
  <script type='text/javascript' src='scripts/types/log.js'></script>
  <script type='text/javascript' src='scripts/types/viz.js'></script>
  <script type='text/javascript' src='scripts/types/horaire.js'></script>

  <script type='text/javascript' src='scripts/lisp.js'></script>
  <script type='text/javascript' src='scripts/lisp.library.js'></script>

  <script type='text/javascript' src='scripts/lisp/benchmark.lisp'></script>
  <script type='text/javascript' src='scripts/lisp/prelude.lisp'></script>
  <script type='text/javascript' src='scripts/lisp/graph.lisp'></script>
  <script type='text/javascript' src='scripts/lisp/template.lisp'></script>

  <link rel='stylesheet' type='text/css' href='links/fonts.css'/>
  <link rel='stylesheet' type='text/css' href='links/main.css'/>
  <title>Loading..</title>
</head>
<body>
  <script>
    const library = new Library()
    const interpreter = new Lisp(library)

    interpreter.run(PROJECTS.prelude+PROJECTS.graph+PROJECTS.template)

    const detectPage = function (onChange) {
      let hashHistory = [window.location.hash]
      let historyLength = window.history.length
      return () => {
        let hash = window.location.hash; let length = window.history.length
        if (hashHistory.length && historyLength === length) {
          if (hashHistory[hashHistory.length - 2] === hash) {
            hashHistory = hashHistory.slice(0, -1)
          } else {
            hashHistory.push(hash)
          }
          onChange()
        } else {
          hashHistory.push(hash)
          historyLength = length
        }
      }
    }

    window.addEventListener('hashchange', detectPage(
      (e) => { BINDINGS.change(window.location.hash.replace(/\+/g,' ').replace('#','')) }
    ))

    window.addEventListener('load', (e) => { 
      BINDINGS.start(window.location.hash.replace(/\+/g,' ').replace('#','')) 
    })

    window.addEventListener('click', (e) => { 
      if (e.button || e.which === 3 || e.button === 2 || e.ctrlKey || e.shiftKey || e.metaKey) { return }
      const el = e.target.getAttribute('data-goto') ? e.target : e.target.parentNode.getAttribute('data-goto') ? e.target.parentNode : null
      if (!el || el.className === 'external') { return }
      BINDINGS.click(el.getAttribute('data-goto').replace(/\+/g,' ')) 
      e.preventDefault()
    })

  </script>
  <noscript>
    <p>Enable JS, pls...</p>
  </noscript>
</body>
</html>
